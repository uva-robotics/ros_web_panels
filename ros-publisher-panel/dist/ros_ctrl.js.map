{"version":3,"sources":["../src/ros_ctrl.js"],"names":["PanelCtrl","_","ros","ROSLIB","Ros","url","on","console","log","error","panelDefaults","topic","$","document","event","preventDefault","data","serializeArray","map","x","name","value","publish_topic","Topic","messageType","msg_type","pub_data","pub","publish","RosCtrl","$scope","$injector","defaultsDeep","panel","events","onInitEditMode","bind","onPanelTeardown","render","onRender","messages","topics","types","getTopics","addEditorTab","$timeout","cancel","nextTickPromise","topicsClient","Service","serviceType","request","ServiceRequest","parent","callService","result","templateUrl"],"mappings":"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","file":"ros_ctrl.js","sourcesContent":["import { PanelCtrl } from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport './roslib.js';\nimport './css/ros-panel.css!';\n\n\nvar ros = new ROSLIB.Ros({\n  url : 'ws://localhost:9090'\n});\n\nros.on('connection', function() {\n  console.log('Connected to websocket server.');\n});\n\nros.on('error', function(error) {\n  console.log('Error connecting to websocket server: ', error);\n});\n\nros.on('close', function() {\n  console.log('Connection to websocket server closed.');\n});\n\nconst panelDefaults = {\n  topic: \"\"\n};\n\n\n$(document).on('submit','.publishForm', function(event) {\n  event.preventDefault();\n\n  var data = {};\n  $(this).serializeArray().map(function(x){data[x.name] = x.value;});\n\n  var publish_topic = new ROSLIB.Topic({\n    ros : ros,\n    name : data.topic,\n    messageType : data.msg_type\n  });\n\n  var pub_data = {}\n  pub_data.data = data.pub;\n  publish_topic.publish(pub_data);\n});\n\nexport class RosCtrl extends PanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    _.defaultsDeep(this.panel, panelDefaults);\n\n    // if (!(this.panel.countdownSettings.endCountdownTime instanceof Date)) {\n      // this.panel.countdownSettings.endCountdownTime = moment(this.panel.countdownSettings.endCountdownTime).toDate();\n    // }\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n\n    this.msg_type = \"\";\n    this.messages = [];\n    this.topics = [];\n    this.types = [];\n\n    this.getTopics();\n  }\n\n  onRender() {\n    console.log(\"RENDERING\");\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/ros-publisher-panel/editor.html', 2);\n  }\n\n  onPanelTeardown() {\n    this.$timeout.cancel(this.nextTickPromise);\n  }\n\n\n  getTopics() {\n    var topicsClient = new ROSLIB.Service({\n      ros : ros,\n      name : '/rosapi/topics',\n      serviceType : 'rosapi/Topics'\n    });\n\n    var request = new ROSLIB.ServiceRequest();\n\n    var parent = this;\n    topicsClient.callService(request, function(result) {\n      parent.topics = result.topics;\n      parent.types = result.types;\n    });\n\n    this.nextTickPromise = this.$timeout(this.getTopics.bind(this), 10000);\n  };\n}\n\nRosCtrl.templateUrl = 'module.html';\n"]}