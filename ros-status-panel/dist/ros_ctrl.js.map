{"version":3,"sources":["../src/ros_ctrl.js"],"names":["PanelCtrl","_","RosCtrl","$scope","$injector","defaultsDeep","panel","panelDefaults","events","on","onInitEditMode","bind","onPanelTeardown","render","onRender","status","ros","ROSLIB","Ros","url","parent","error","topic","messages","topics","types","ping","console","log","addEditorTab","$timeout","cancel","nextTickPromise","pingClient","Service","name","serviceType","request","ServiceRequest","callService","result","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,e,kBAAAA,S;;AACFC,O;;;;;;;;;;;;;;;;;;;;;yBAKMC,O;;;AACX,yBAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,wHACvBD,MADuB,EACfC,SADe;;AAE7BH,YAAEI,YAAF,CAAe,MAAKC,KAApB,EAA2BC,aAA3B;;AAEA;AACA;AACA;;AAEA,gBAAKC,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKG,eAAL,CAAqBD,IAArB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,mBAAf,EAAoC,MAAKI,MAAL,CAAYF,IAAZ,OAApC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKK,QAAL,CAAcH,IAAd,OAAzB;;AAEA,gBAAKI,MAAL,GAAc,KAAd;;AAEA,gBAAKC,GAAL,GAAW,IAAIC,OAAOC,GAAX,CAAe;AACxBC,iBAAM;AADkB,WAAf,CAAX;;AAIA,cAAIC,cAAJ;AACA,gBAAKJ,GAAL,CAASP,EAAT,CAAY,YAAZ,EAA0B,YAAW;AACnCW,mBAAOL,MAAP,GAAgB,IAAhB;AACD,WAFD;;AAIA,gBAAKC,GAAL,CAASP,EAAT,CAAY,OAAZ,EAAqB,UAASY,KAAT,EAAgB;AACnCD,mBAAOL,MAAP,GAAgB,KAAhB;AACD,WAFD;;AAIA,gBAAKC,GAAL,CAASP,EAAT,CAAY,OAAZ,EAAqB,YAAW;AAC9BW,mBAAOL,MAAP,GAAgB,KAAhB;AACD,WAFD;;AAIA,cAAMR,gBAAgB;AACpBe,mBAAO;AADa,WAAtB;;AAIA,gBAAKC,QAAL,GAAgB,EAAhB;AACA,gBAAKC,MAAL,GAAc,EAAd;AACA,gBAAKC,KAAL,GAAa,EAAb;;AAEA,gBAAKC,IAAL;AAxC6B;AAyC9B;;;;qCAEU;AACTC,oBAAQC,GAAR,CAAY,WAAZ;AACD;;;2CAEgB;AACf,iBAAKC,YAAL,CAAkB,SAAlB,EAA6B,sCAA7B,EAAqE,CAArE;AACD;;;4CAEiB;AAChB,iBAAKC,QAAL,CAAcC,MAAd,CAAqB,KAAKC,eAA1B;AACD;;;iCAGM;;AAEL,gBAAIZ,SAAS,IAAb;AACA,gBAAIa,aAAa,IAAIhB,OAAOiB,OAAX,CAAmB;AAClClB,mBAAM,KAAKA,GADuB;AAElCmB,oBAAO,eAF2B;AAGlCC,2BAAc;AAHoB,aAAnB,CAAjB;;AAMA,gBAAIC,UAAU,IAAIpB,OAAOqB,cAAX,CAA0B,EAA1B,CAAd;AACAL,uBAAWM,WAAX,CAAuBF,OAAvB,EAAgC,UAASG,MAAT,EAAiB;AAC/C,kBAAIA,MAAJ,EAAY;AACVpB,uBAAOL,MAAP,GAAgB,IAAhB;AACD,eAFD,MAGK;AACHK,uBAAOL,MAAP,GAAgB,KAAhB;AACD;AACF,aAPD;;AAWAY,oBAAQC,GAAR,CAAY,MAAZ;AACA,iBAAKI,eAAL,GAAuB,KAAKF,QAAL,CAAc,KAAKJ,IAAL,CAAUf,IAAV,CAAe,IAAf,CAAd,EAAoC,IAApC,CAAvB;AACD;;;;QAhF0BX,S;;;;AAmF7BE,cAAQuC,WAAR,GAAsB,aAAtB","file":"ros_ctrl.js","sourcesContent":["import { PanelCtrl } from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport './roslib.js';\nimport './css/ros-panel.css!';\n\n\nexport class RosCtrl extends PanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    _.defaultsDeep(this.panel, panelDefaults);\n\n    // if (!(this.panel.countdownSettings.endCountdownTime instanceof Date)) {\n    // this.panel.countdownSettings.endCountdownTime = moment(this.panel.countdownSettings.endCountdownTime).toDate();\n    // }\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n\n    this.status = false;\n\n    this.ros = new ROSLIB.Ros({\n      url : 'ws://localhost:9090'\n    });\n\n    var parent = this;\n    this.ros.on('connection', function() {\n      parent.status = true;\n    });\n\n    this.ros.on('error', function(error) {\n      parent.status = false;\n    });\n\n    this.ros.on('close', function() {\n      parent.status = false;\n    });\n\n    const panelDefaults = {\n      topic: \"\"\n    };\n\n    this.messages = [];\n    this.topics = [];\n    this.types = [];\n\n    this.ping();\n  }\n\n  onRender() {\n    console.log(\"RENDERING\");\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/ros-panel/editor.html', 2);\n  }\n\n  onPanelTeardown() {\n    this.$timeout.cancel(this.nextTickPromise);\n  }\n\n\n  ping() {\n\n    var parent = this;\n    var pingClient = new ROSLIB.Service({\n      ros : this.ros,\n      name : '/rosapi/nodes',\n      serviceType : 'rosapi/Nodes'\n    });\n\n    var request = new ROSLIB.ServiceRequest({});\n    pingClient.callService(request, function(result) {\n      if (result) {\n        parent.status = true;\n      }\n      else {\n        parent.status = false;\n      }\n    });\n\n\n\n    console.log(\"PING\");\n    this.nextTickPromise = this.$timeout(this.ping.bind(this), 5000);\n  };\n}\n\nRosCtrl.templateUrl = 'module.html';\n"]}