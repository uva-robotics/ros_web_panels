{"version":3,"sources":["../src/ros_ctrl.js"],"names":["PanelCtrl","_","panelDefaults","topic","RosCtrl","$scope","$injector","defaultsDeep","panel","events","on","onInitEditMode","bind","onPanelTeardown","render","ros","ROSLIB","Ros","url","subscribeTopic","topics","types","battery_level","getTopics","addEditorTab","$timeout","cancel","nextTickPromise","listener","Topic","name","messageType","parent","subscribe","message","console","log","data","topicsClient","Service","serviceType","request","ServiceRequest","callService","result","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,e,kBAAAA,S;;AACFC,O;;;;;;;;;;;;;;;;;;;;;AAIDC,mB,GAAgB;AACpBC,eAAO;AADa,O;;yBAITC,O;;;AACX,yBAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,wHACvBD,MADuB,EACfC,SADe;;AAE7BL,YAAEM,YAAF,CAAe,MAAKC,KAApB,EAA2BN,aAA3B;;AAIA,gBAAKO,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKG,eAAL,CAAqBD,IAArB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,mBAAf,EAAoC,MAAKI,MAAL,CAAYF,IAAZ,OAApC;;AAEA,gBAAKG,GAAL,GAAW,IAAIC,OAAOC,GAAX,CAAe;AACxBC,iBAAM;AADkB,WAAf,CAAX;;AAIA,cAAI,MAAKV,KAAL,CAAWL,KAAX,IAAoB,EAAxB,EAA4B;AAC1B,kBAAKgB,cAAL,CAAoB,MAAKX,KAAL,CAAWL,KAA/B;AACD;;AAED,gBAAKiB,MAAL,GAAc,EAAd;AACA,gBAAKC,KAAL,GAAa,EAAb;AACA,gBAAKC,aAAL,GAAqB,CAArB;AACA,gBAAKC,SAAL;AArB6B;AAsB9B;;;;2CAEgB;AACf,iBAAKC,YAAL,CAAkB,SAAlB,EAA6B,gDAA7B,EAA+E,CAA/E;AACD;;;4CAEiB;AAChB,iBAAKC,QAAL,CAAcC,MAAd,CAAqB,KAAKC,eAA1B;AACD;;;yCAGcxB,K,EAAO;AACpB,gBAAIyB,WAAW,IAAIZ,OAAOa,KAAX,CAAiB;AAC9Bd,mBAAM,KAAKA,GADmB;AAE9Be,oBAAO3B,KAFuB;AAG9B4B,2BAAc;AAHgB,aAAjB,CAAf;;AAMA,iBAAKvB,KAAL,CAAWL,KAAX,GAAmBA,KAAnB;AACA,gBAAI6B,SAAS,IAAb;AACAJ,qBAASK,SAAT,CAAmB,UAASC,OAAT,EAAkB;AACnCC,sBAAQC,GAAR,CAAYF,OAAZ;AACAF,qBAAOV,aAAP,GAAuBY,QAAQG,IAA/B;AACD,aAHD;AAID;;;sCAEW;AACV,gBAAIC,eAAe,IAAItB,OAAOuB,OAAX,CAAmB;AACpCxB,mBAAM,KAAKA,GADyB;AAEpCe,oBAAO,gBAF6B;AAGpCU,2BAAc;AAHsB,aAAnB,CAAnB;;AAMA,gBAAIC,UAAU,IAAIzB,OAAO0B,cAAX,EAAd;;AAEA,gBAAIV,SAAS,IAAb;AACAM,yBAAaK,WAAb,CAAyBF,OAAzB,EAAkC,UAASG,MAAT,EAAiB;AACjDZ,qBAAOZ,MAAP,GAAgBwB,OAAOxB,MAAvB;AACAY,qBAAOX,KAAP,GAAeuB,OAAOvB,KAAtB;AACD,aAHD;;AAKA,iBAAKM,eAAL,GAAuB,KAAKF,QAAL,CAAc,KAAKF,SAAL,CAAeX,IAAf,CAAoB,IAApB,CAAd,EAAyC,KAAzC,CAAvB;AACD;;;;QAjE0BZ,S;;;;AAoE7BI,cAAQyC,WAAR,GAAsB,aAAtB","file":"ros_ctrl.js","sourcesContent":["import { PanelCtrl } from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport './roslib.js';\nimport './css/ros-panel.css!';\n\nconst panelDefaults = {\n  topic: \"\"\n};\n\nexport class RosCtrl extends PanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    _.defaultsDeep(this.panel, panelDefaults);\n\n\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n\n    this.ros = new ROSLIB.Ros({\n      url : 'ws://localhost:9090'\n    });\n\n    if (this.panel.topic != \"\") {\n      this.subscribeTopic(this.panel.topic);\n    }\n\n    this.topics = [];\n    this.types = [];\n    this.battery_level = 0;\n    this.getTopics();\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/ros-publisher-panel/editor.html', 2);\n  }\n\n  onPanelTeardown() {\n    this.$timeout.cancel(this.nextTickPromise);\n  }\n\n\n  subscribeTopic(topic) {\n    var listener = new ROSLIB.Topic({\n      ros : this.ros,\n      name : topic,\n      messageType : 'std_msgs/String'\n    });\n\n    this.panel.topic = topic;\n    var parent = this;\n    listener.subscribe(function(message) {\n      console.log(message);\n      parent.battery_level = message.data;\n    });\n  }\n\n  getTopics() {\n    var topicsClient = new ROSLIB.Service({\n      ros : this.ros,\n      name : '/rosapi/topics',\n      serviceType : 'rosapi/Topics'\n    });\n\n    var request = new ROSLIB.ServiceRequest();\n\n    var parent = this;\n    topicsClient.callService(request, function(result) {\n      parent.topics = result.topics;\n      parent.types = result.types;\n    });\n\n    this.nextTickPromise = this.$timeout(this.getTopics.bind(this), 10000);\n  };\n}\n\nRosCtrl.templateUrl = 'module.html';\n"]}